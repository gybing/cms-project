<?xml version="1.0" encoding="UTF-8"?>
<mappers xmlns="http://www.weimingfj.com" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://itest.56913.com:20080/xsd/mappers.xsd">
	<!-- 新增房间信息 -->
	<mapper id="saveRoomInfo">
		<sql key="saveRoomInfo" operator="execute">
			INSERT INTO `sys_room_tab` 
				(
					`id`, `room_no`, `building_no`, `room_type`, `room_state`,
					`room_floor`,
					<isNotEmpty property="CONSTRUCTION_AREA">
						`construction_area`,
					</isNotEmpty>
					<isNotEmpty property="ROOM_AREA">
						`room_area`,
					</isNotEmpty>
					 <isNotEmpty property="PUBLIC_AREA">
						 `public_area`,
					</isNotEmpty>  
					`decration_state`, `room_toward`, `remark`, `create_date`
				) 
				VALUES
				(
					UUID(), #{room_no}, #{building_no}, #{room_type}, #{room_state}, 
					#{room_floor},
					<isNotEmpty property="CONSTRUCTION_AREA">
						${construction_area},
					</isNotEmpty>
					<isNotEmpty property="ROOM_AREA">
						 ${room_area},
					</isNotEmpty>
					<isNotEmpty property="PUBLIC_AREA">
						 ${public_area},
					</isNotEmpty>  
					#{decration_state},#{room_toward}, #{remark}, now()
				);
		</sql>
	</mapper>
	<!-- 更新楼宇信息 -->
	<mapper id="updateBuildingInfo">
		<sql key="" operator="execute">
			UPDATE `sys_building_tab`
				SET 
				 `building_no` = #{BUILDING_NO},
				 `building_name` = #{BUILDING_NAME},
				 `building_floors` = ${BUILDING_FLOORS},
				 `building_addr` = #{BUILDING_ADDR},
				 `building_type` = #{BUILDING_TYPE},
				 `building_structure` = #{BUILDING_STRUCTURE},
				 `building_toward` = #{BUILDING_TOWARD},
				 `remark` = #{REMARK}
				WHERE
					(
						`id` = #{b_id}
					);
		</sql>
	</mapper>
	<!-- 删除楼宇信息 -->
	<mapper id="deleteBuildingInfo">
		<sql key="deleteBuildingInfo" operator="execute">
			update sys_building_tab set is_del = 'Y' where id = #{b_id}
		</sql>
	</mapper>
	<!-- 获取楼宇信息 -->
	<mapper id="getBuildingInfo">
		<sql key="getBuildingInfo" operator="select" resultType="map">
			select `building_no`,`building_name`,`building_floors`,`building_addr`,`building_type`,`building_structure`,`building_toward`,`create_date`,`remark`
				from sys_building_tab where 1=1
			<isNotEmpty property="b_id">
				and id = #{b_id}
			</isNotEmpty>
		</sql>
	</mapper>
	<!-- 房间信息列表 -->
	<mapper id="qryRoomList">
		<sql key="qryRoomList" operator="select" resultType="paging">
			<isNotEmpty property="query_count">
				select count(distinct srt.id)
			</isNotEmpty>
			<isEmpty property="query_count">
				select (@i:=@i+1) num,a.* from (
				select srt.`id`,
				    srt.`room_no`,
				   	(SELECT sbt.building_no FROM sys_building_tab sbt WHERE sbt.id = srt.`building_no`) building_no,
					(SELECT sbt.building_name FROM sys_building_tab sbt WHERE sbt.id = srt.`building_no`) building_name,
				    (SELECT dc.text FROM dict_common dc where dc.code = srt.`room_type` AND dc.type = 'room_type') `room_type`,
				    srt.`room_state`,
				    srt.`room_floor`,
				    srt.`construction_area`,
				    srt.`room_area`,
				    srt.`public_area`,
				    srt.`decration_state`,
				    srt.`room_toward`,
					DATE_FORMAT (srt.`create_date`,'%Y-%m-%d %T') `create_date`,
				    srt.`remark`
			</isEmpty>
			from sys_room_tab srt where 1=1 and srt.is_del = 'N'
			<isNotEmpty property="columns[0][search][value]">
				and srt.room_no LIKE '%${columns[0][search][value]}%'
			</isNotEmpty>
			<isNotEmpty property="columns[1][search][value]">
				and srt.room_state = '${columns[1][search][value]}'
			</isNotEmpty>
			<isNotEmpty property="columns[2][search][value]">
				and srt.building_no = '${columns[2][search][value]}'
			</isNotEmpty>
			<isNotEmpty property="columns[3][search][value]">
				and srt.room_type = '${columns[3][search][value]}'
			</isNotEmpty>
			<isNotEmpty property="columns[4][search][value]">
				and srt.building_name like '%${columns[4][search][value]}%'
			</isNotEmpty>
			<isEmpty property="query_count">
				order by srt.create_date desc
				limit ${page_start},${page_end}
				) a,(select @i:= ${page_start} ) it
			</isEmpty>
		</sql>
	</mapper>
</mappers>