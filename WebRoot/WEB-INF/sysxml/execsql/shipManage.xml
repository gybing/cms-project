<?xml version="1.0" encoding="UTF-8"?>
<mappers xmlns="http://www.weimingfj.com" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://itest.56913.com:20080/xsd/mappers.xsd">
	
	<!-- 船舶列表 -->
	<mapper id="queryShipList">
	    <sql key="queryShipList" resultType="paging" operator="select">
	        SELECT
			<isEmpty property="query_count">
				(@i:=@i+1) seq,A.* from 
	      	( select
				ts.SHIP_ID,
				ts.CODE,
				ts.LLOYD_IMO_CODE,
				ts.NAME_EN,
				ts.NAME_CN,
				ts.LOAD_PORT,
				ts.INTER_PORT,
				ts.UNLOAD_PORT,
				ts.SHIP_OWNNER
			</isEmpty>
			<isNotEmpty property="query_count">
				count(1)
			</isNotEmpty>
			FROM
				tab_ship ts 
			WHERE
				ts.tag=(select TAG from user_tab where USER_ID = '$_CRU_USER_ID_$') 
				AND ts.is_del='N' 
				<isNotEmpty property="columns[0][search][value]">
					AND ts.search_field LIKE '%${columns[0][search][value]}%'
				</isNotEmpty>
				<isEmpty property="query_count">
					<!-- <isNotEmpty property="sortname">
						order by ${sortname} ${sortorder}
					</isNotEmpty>
					<isEmpty property="sortname">
						ORDER BY
							ts.name_en DESC 
					</isEmpty> -->
					ORDER BY
							ts.name_en DESC
					limit ${page_start}, ${page_end}
					) A,(SELECT @i:= ${page_start} ) it
				</isEmpty>
	    </sql>
	</mapper>
	
	<!-- 新增船舶 -->
	<mapper id="addShip">
	    <sql key="addShip" operator="execute">
	    INSERT INTO tab_ship (
			ship_id,tag,`code`,shortcut,lloyd_imo_code,dingcang,AMS,name_en,name_cn,line,`call`,stop_port,load_port,inter_port,unload_port,tonnage,belong_country,flag_country,ship_ownner,book_company,other_code_1,other_code_2,remark,search_field,is_del
		)
		VALUES
		(
			UUID(),(select TAG from user_tab where USER_ID = '$_CRU_USER_ID_$'),#{addShipCode},#{addShipShortcut},#{addShipLloydImoCode},#{addHiddenDingcang},#{addHiddenAMS},#{addShipEnName},#{addShipCnName},#{addShipLine},#{addShipCall},#{addShipStopPort},#{addShipLoadPort},#{addShipInterPort},#{addShipUnloadPort},#{addShipTonnage},#{addShipBelongCountry},#{addShipFlagCountry},#{addShipOwnner},#{addShipBookCompany},#{addShipOtherCode1},#{addShipOtherCode2},#{addShipRemark},#{addShipCode}#{addShipEnName}#{addShipCnName}#{addShipOwnner},'N'
		) 
	    </sql>
	</mapper>
	
	<!-- 修改船舶 -->
	<mapper id="editShip">
	    <sql key="editShip" operator="execute">
	    UPDATE tab_ship SET
			`code`=#{editShipCode},
			shortcut=#{editShipShortcut},
			lloyd_imo_code=#{editShipLloydImoCode},
			dingcang=#{editHiddenDingcang},
			AMS=#{editHiddenAMS},
			name_en=#{editShipEnName},
			name_cn=#{editShipCnName},
			line=#{editShipLine},
			`call`=#{editShipCall},
			stop_port=#{editShipStopPort},
			load_port=#{editShipLoadPort},
			inter_port=#{editShipInterPort},
			unload_port=#{editShipUnloadPort},
			tonnage=#{editShipTonnage},
			belong_country=#{editShipBelongCountry},
			flag_country=#{editShipFlagCountry},
			ship_ownner=#{editShipOwnner},
			book_company=#{editShipBookCompany},
			other_code_1=#{editShipOtherCode1},
			other_code_2=#{editShipOtherCode2},
			remark=#{editShipRemark},
			search_field=#{editShipCode}#{editShipEnName}#{editShipCnName}#{editShipOwnner}
		WHERE ship_id=#{editShipId}

	    </sql>
	</mapper>
	
	<!-- 删除船舶 -->
	<mapper id="delShip">
	    <sql key="delShip" operator="execute">
	    	UPDATE tab_ship SET is_del='Y' where ship_id = #{delShipId}
		</sql>
	</mapper>
	
	<!-- 据id查询船舶详情 -->
	<mapper id="queryShipInfoById">
	    <sql key="queryShipInfoById" resultType="map" operator="select">
	    SELECT
			ts.*
		FROM
			tab_ship AS ts
		WHERE
			ts.ship_id = #{editShipId}
		</sql>
	</mapper>
</mappers>