<?xml version="1.0" encoding="UTF-8"?>
<mappers xmlns="http://www.weimingfj.com" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://itest.56913.com:20080/xsd/mappers.xsd">
	
	<!-- 地点列表 -->
	<mapper id="qryAreaList">
	    <sql key="qryAreaList" resultType="paging" operator="select">
	      	SELECT
			<isNotEmpty property="query_count">
				COUNT(t.ID) 
			</isNotEmpty>
	      	<isEmpty property="query_count">
	      	 (@i:=@i+1) seq,A.* from (
	      	 select 
	      	 t.ID, 
	      	 concat(t.NAME,case t.is_default_park when 'Y' then '(默认停车场)' else '' end ) NAME,
	      	 t.CODE, 
	      	 t.PROVINCE, 
	      	 t.CITY, 
	      	 concat(t.PROVINCE, t.CITY) city_addr,
	      	 t.REMARK
      	 	</isEmpty>
	      	 from dict_area t
	        <isNotEmpty  property="columns[0][search][value]">
		        where search_field like '%${columns[0][search][value]}%'
	        </isNotEmpty>
	        <isEmpty property="query_count">
				ORDER BY t.ID DESC
				LIMIT ${page_start},${page_end}
				) A,(SELECT @i:= ${page_start} ) it
			</isEmpty>
	    </sql>
	</mapper>
	<!-- 新增地点 -->
	<mapper id="addArea">
	    <sql key="addArea" operator="execute">
	        insert into dict_area(id,tag,name,code,shortcut,lng,lat,province,city,city_code,addr,schedule_center,remark,matou,duichang,cangku,tixiangmatou,tuochedidian,chengshidiqu,fanxiangmatou,chezhan,haiguankouan,shifazhan,mudizhan,bianjingzhan,search_field) 
	        values(UUID(),#{tag},#{areaName},#{areaCode},#{namxxe},#{lng},#{lat},#{province},#{city},#{area_add_addr},#{areaAddr},#{scheduleCenter},#{remark},#{matou},#{duichang},#{cangku},#{tixiangmatou},#{tuochedidian},#{chengshidiqu},#{fanxiangmatou},#{chezhan},#{haiguankouan},#{shifazhan},#{mudizhan},#{bianjingzhan},#{areaName}#{areaCode}#{province}#{city})
	    </sql>
	</mapper>
	<!-- 修改地点 -->
	<mapper id="editArea">
	    <sql key="editArea" operator="execute">
	        update dict_area set name=#{areaName},shortcut=#{namxxe},code=#{areaCode},lng=#{lng},lat=#{lat},province=#{province},city=#{city},city_code=#{area_edit_addr},addr=#{areaAddr},schedule_center=#{scheduleCenter},remark=#{remark},matou=#{matou},duichang=#{duichang},
	        cangku=#{cangku},tixiangmatou=#{tixiangmatou},tuochedidian=#{tuochedidian},chengshidiqu=#{chengshidiqu},fanxiangmatou=#{fanxiangmatou},chezhan=#{chezhan},haiguankouan=#{haiguankouan},shifazhan=#{shifazhan},mudizhan=#{mudizhan},bianjingzhan=#{bianjingzhan},search_field=#{areaName}#{areaCode}#{province}#{city} where id = #{areaId}
	    </sql>
	</mapper>
	<!-- 删除地点 -->
	<mapper id="delArea">
	    <sql key="delArea" operator="execute">
	        delete from dict_area where id = #{id}
	    </sql>
	</mapper>
	<!-- 获取调度中心信息 -->
	<mapper id="getAreaScheduleCenter">
	    <sql key="getAreaScheduleCenter" resultType="list" operator="select">
	        select * from tab_schedule_center
	    </sql>
	</mapper>
	<!-- 根据id获取地点信息 -->
	<mapper id="getAreaById">
	    <sql key="getAreaById" resultType="map" operator="select">
	        select t.*,tsc.center_name from dict_area t
	        left join tab_schedule_center tsc on t.schedule_center = tsc.center_code  
	        where 1 = 1
	        <isNotEmpty property="id">
	        	and  t.id = #{id}
	        </isNotEmpty>
	        <isNotEmpty property="name">
	        	and t.name = #{name}
	        </isNotEmpty>
	    </sql>
	</mapper>
	<!-- 根据id获取地点信息 -->
	<mapper id="qryAreaByCode">
	    <sql key="qryAreaByCode" resultType="string" operator="select">
	        select count(1) from dict_area t
	        where t.code = #{code}
	    </sql>
	</mapper>
	<!-- 设置默认停车场 -->
	<mapper id="setDefaultPark">
	    <sql key="resetDefaultPark"  operator="execute">
	        update dict_area set is_default_park='N'
	        where is_default_park = 'Y'
	    </sql>
	    <sql key="setDefaultPark"  operator="execute">
	        update dict_area set is_default_park='Y'
	        where id = #{id}
	    </sql>
	</mapper>
	<!-- 查询出发地及目的地选择框 -->
	<mapper id="getAreaDictType">
	    <sql key="getAreaDictType" resultType="list" operator="select">
	      	SELECT name,code from dict_area
	        
	    </sql>
	</mapper>
	<!--获取所有的调度中心  -->
	<mapper id="getScheduleCenter">
	    <sql key="getScheduleCenter" resultType="list" operator="select">
	      	SELECT center_name,center_code FROM tab_schedule_center
	    </sql>
	</mapper>
	<!-- 司机列表 -->
	<mapper id="showDriver">
	    <sql key="showDriver" resultType="autoPaging" operator="select">
	      	SELECT * FROM tab_driver WHERE is_del='N' and tag=#{tag}  
	    </sql>
	</mapper>
	<!-- 双拖的另外一个箱子的调度单查询-->
	<mapper id="findShuangtuoSchedule">
	    <sql key="findShuangtuoSchedule" resultType="map" operator="select">
	      	SELECT t.*,dt.name to_text,df.name from_text,tob.no box_no FROM tab_order_box_schedule  t
	      	LEFT JOIN dict_area dt on dt.code = t.to 
	      	LEFT JOIN dict_area df on df.code = t.from 
	      	LEFT JOIN tab_order_box tob on tob.box_id = t.box_id
	      	 WHERE t.schedule_id=#{schedule_id}
	    </sql>
	</mapper>
	<!--  集装箱下拉框-->
	<mapper id="boxlist">
	    <sql key="boxlist" resultType="list" operator="select">
	      	SELECT tob.box_id ID,CONCAT("订单号:",tod.order_no,"箱号:",tob.no,"尺寸:",tob.size) TEXT,tob.no FROM tab_order_box tob
	      	left join tab_order tod on tob.order_id = tod.order_id 
			WHERE tob.order_id IN(SELECT order_id FROM tab_order WHERE is_del='N' AND is_finish!='Y') 
			AND size='20' and NOT EXISTS (SELECT box_id FROM tab_order_box_schedule a WHERE a.command = '4' and a.box_id = tob.box_id) AND tob.tag=#{tag}
			<isNotEmpty property="boxId">
			      AND tob.box_id!=#{boxId}
		    </isNotEmpty>
		</sql>
	</mapper>
	<!-- 获取码头信息 -->
	<mapper id="getWharf">
	    <sql key="getWharf" resultType="list" operator="select">
	        select * from dict_area WHERE matou = 1
	    </sql>
	</mapper>
	<!--  删除反馈图片-->
	<mapper id="delImage">
	    <sql key="delImage" operator="excute">
<!-- 	        UPDATE tab_order_box_schedule_feedback SET  -->
<!-- 	        <isEqual property="TYPE" compareValue="dict_area"> -->
<!-- 	    	</isEqual> -->
<!-- 	         WHERE fb_id=#{id}  -->
	    </sql>
	</mapper>
	<!-- 获取默认停车场 -->
	<mapper id="getDefaultPark">
		<sql key="getDefaultPark" operator="select" resultType="map">
			SELECT dt.id,dt.`name`,dt.lng,dt.lat,dt.`code` FROM dict_area dt WHERE dt.is_default_park = 'Y' LIMIT 1;
		</sql>
	</mapper>
</mappers>